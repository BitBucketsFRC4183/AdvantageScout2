<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>Advantage Scout</title>

        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell,
                    "Helvetica Neue", sans-serif;
            }
        </style>

        <style id="appStyles"></style>

        <script type="module">
            window.isWeb = ISWEB; // Replaced by web server or during app build

            function start(data) {
                window.gameConfig = data.config;
                document.getElementById("appStyles").innerHTML = data.css;
                document.body.innerHTML = "";
                const App = new Function(data.js.replace("var App=", "return "))();
                window.app = new App();
            }

            window.addEventListener("load", () => {
                import(isWeb ? "/ServerInterfaceWeb.js" : "/ServerInterfaceApp.js").then((ServerInterface) => {
                    window.serverInterface = new ServerInterface.default();

                    var cache = window.localStorage.getItem("appData");
                    if (cache != null) {
                        cache = JSON.parse(cache);
                        start(cache);
                    }

                    serverInterface
                        .request("download_app", { hash: cache == null ? "" : cache.hash })
                        .then((response) => {
                            if (response.changed) {
                                start(response.data);
                                window.localStorage.setItem("appData", JSON.stringify(response.data));
                            }
                        });
                });
            });
        </script>
    </head>

    <body></body>
</html>
