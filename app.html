<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>Advantage Scout</title>

        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell,
                    "Helvetica Neue", sans-serif;
            }
        </style>

        <style id="appStyles"></style>

        <script type="module">
            window.isWeb = ISWEB; // Replaced by web server or during app build

            function start(data) {
                window.gameConfig = data.config;
                document.getElementById("appStyles").innerHTML = data.css;
                document.body.innerHTML = "";
                const App = new Function("return " + data.js.substring(8))();
                window.app = new App();
            }

            window.suppressReload = false;
            function reload(firstRequest) {
                var cache = window.localStorage.getItem("appData");
                if (cache != null) {
                    cache = JSON.parse(cache);
                    if (firstRequest) {
                        start(cache);
                    }
                }

                serverInterface.request("download_app", { hash: cache == null ? "" : cache.hash }).then((response) => {
                    if (response != null && response.changed) {
                        window.localStorage.setItem("appData", JSON.stringify(response.data));
                        if (!firstRequest && (window.supressReload || !confirm("The app has changed. Reload?"))) {
                            window.suppressReload = true;
                            return;
                        }
                        start(response.data);
                    }
                });
            }

            window.addEventListener("load", () => {
                if (isWeb) {
                    document.head.innerHTML += '<link rel="icon" type="image/x-icon" href="/favicon.ico" />';
                }

                import(isWeb ? "/ServerInterfaceWeb.js" : "/ServerInterfaceApp.js").then((ServerInterface) => {
                    window.serverInterface = new ServerInterface.default();
                    reload(true);
                    window.setInterval(() => reload(false), 2000);
                });
            });
        </script>
    </head>

    <body></body>
</html>
